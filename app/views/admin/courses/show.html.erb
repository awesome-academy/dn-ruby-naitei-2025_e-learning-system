<p style="color: green"><%= notice %></p>

<div class="accordion" id="courseContentAccordion" data-turbo="false">
  <div class="card mb-4 shadow-sm">
    <img src="<%= @course.thumbnail_url.presence || 'https://via.placeholder.com/800x400' %>"
         class="card-img-top"
         alt="<%= @course.title %>">

    <div class="card-body">
      <h3><%= @course.title %></h3>
      <p class="text-muted"><%= @course.category&.name || t('admin.courses.show.uncategorized') %></p>
      <p><%= @course.description %></p>

      <hr>

      <div class="mb-3">
        <%= link_to t('admin.courses.show.add_module'), new_admin_course_course_module_path(@course), class: "btn btn-primary me-2" %>
        <%= link_to t('admin.courses.show.edit_course'), edit_admin_course_path(@course), class: "btn btn-warning me-2" %>
        <%= link_to t('admin.courses.show.delete_course'), admin_course_path(@course), data: {
              turbo_method: :delete,
              turbo_confirm: t('admin.courses.show.confirm_delete_course')
            }, class: "btn btn-danger" %>
      </div>

      <%= link_to t('admin.courses.show.back_to_list'), admin_courses_path, class: "btn btn-outline-secondary" %>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h4 class="mb-0"><%= t('admin.courses.show.content_admin') %></h4>
    </div>

    <div class="card-body">
      <div class="accordion" id="courseContentAccordion">
        <% if @course.course_modules.empty? %>
          <p class="text-muted"><%= t('admin.courses.show.no_content') %></p>
        <% end %>

        <% @course.course_modules.each_with_index do |module_item, index| %>
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-<%= module_item.id %>">
              <button class="accordion-button <%= 'collapsed' if index > 0 %>"
                      type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-<%= module_item.id %>"
                      aria-expanded="<%= index == 0 ? 'true' : 'false' %>"
                      aria-controls="collapse-<%= module_item.id %>">
                <strong><%= module_item.title %></strong>
              </button>
            </h2>

            <div id="collapse-<%= module_item.id %>"
                 class="accordion-collapse collapse <%= 'show' if index == 0 %>"
                 aria-labelledby="heading-<%= module_item.id %>"
                 data-bs-parent="#courseContentAccordion">

              <div class="accordion-body">
                <div class="admin-actions p-2 mb-3 rounded"
                     style="background-color: #f8f9fa; border: 1px solid #dee2e6;">
                  <p class="mb-2"><em><%= t('admin.courses.show.module_admin') %></em></p>

                  <%= link_to t('admin.courses.show.edit_module'), edit_admin_course_module_path(module_item), class: "btn btn-sm btn-outline-secondary" %>
                  <%= link_to t('admin.courses.show.delete_module'), admin_course_module_path(module_item), data: {
                        turbo_method: :delete,
                        turbo_confirm: t('admin.courses.show.confirm_delete_module', title: module_item.title)
                      }, class: "btn btn-sm btn-outline-danger" %>
                  <hr>
                  <%= link_to t('admin.courses.show.add_lesson'), new_admin_course_module_lesson_path(module_item), class: "btn btn-success btn-sm" %>
                </div>

                <ul class="list-group list-group-flush">
                  <% if module_item.lessons.empty? %>
                    <li class="list-group-item text-muted"><em><%= t('admin.courses.show.no_lessons') %></em></li>
                  <% end %>

                  <% module_item.lessons.each do |lesson| %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span><%= lesson.title %></span>
                      <span class="lesson-admin-actions">
                        <%= link_to t('admin.courses.show.view'), lesson_path(lesson), class: "btn btn-sm btn-outline-info", target: "_blank" %>
                        <%= link_to t('admin.courses.show.edit'), edit_admin_lesson_path(lesson), class: "btn btn-sm btn-outline-warning" %>
                        <%= link_to t('admin.courses.show.delete'), admin_lesson_path(lesson), data: {
                              turbo_method: :delete,
                              turbo_confirm: t('admin.courses.show.confirm_delete_lesson', title: lesson.title)
                            }, class: "btn btn-sm btn-outline-danger" %>
                      </span>
                    </li>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
