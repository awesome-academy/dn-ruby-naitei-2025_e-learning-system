<div class="bg-dark text-white py-5 mb-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <span class="badge bg-warning text-dark mb-2"><%= @course.category&.name %></span>
        <h1 class="display-4 fw-bold"><%= @course.title %></h1>
        <p class="lead"><%= @course.description %></p>
        <div class="mt-4">
          <%# Nút hành động chính %>
          <% first_lesson = @course.course_modules.first&.lessons&.first %>
          <% if first_lesson %>
            <%= link_to "Bắt đầu học ngay", lesson_path(first_lesson), class: "btn btn-primary btn-lg px-4 me-2" %>
          <% else %>
            <button class="btn btn-secondary btn-lg px-4 me-2" disabled>Đang cập nhật</button>
          <% end %>
        </div>
      </div>
      <div class="col-md-4 d-none d-md-block">
        <img src="<%= @course.thumbnail_url.presence || 'https://via.placeholder.com/400x300' %>" class="img-fluid rounded shadow-lg">
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <div class="col-lg-8">
      <h3 class="mb-4">Nội dung khóa học</h3>

      <div class="accordion" id="accordionCourse">
        <% @course.course_modules.each_with_index do |mod, index| %>
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading<%= mod.id %>">
              <button class="accordion-button <%= 'collapsed' if index > 0 %> fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= mod.id %>">
                <%= mod.title %>
              </button>
            </h2>
            <div id="collapse<%= mod.id %>" class="accordion-collapse collapse <%= 'show' if index == 0 %>" data-bs-parent="#accordionCourse">
              <div class="accordion-body p-0">
                <div class="list-group list-group-flush">
                  <% mod.lessons.each do |lesson| %>
                    <%= link_to lesson_path(lesson), class: "list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3" do %>
                      <span><i class="bi bi-play-circle me-2 text-muted"></i> <%= lesson.title %></span>
                      <% if lesson.video_url.present? %>
                        <span class="badge bg-light text-dark">Video</span>
                      <% end %>
                    <% end %>
                  <% end %>

                  <% if mod.lessons.empty? %>
                     <div class="p-3 text-muted fst-italic">Chưa có bài học.</div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title">Giảng viên</h5>
          <div class="d-flex align-items-center mt-3">
             <img src="https://ui-avatars.com/api/?name=<%= @course.creator&.name %>" class="rounded-circle me-3" width="50">
             <div>
               <h6 class="mb-0"><%= @course.creator&.name || "Admin" %></h6>
               <small class="text-muted">Instructor</small>
             </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
